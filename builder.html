<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Primary SEO -->
  <title>Christmas Coffee Gift Set Builder ‚Äî Curated Coffee Gifts by Reece at Tasse & Groundwork</title>
  <meta name="description" content="Build a barista-approved coffee Christmas gift in minutes. Pick your budget, answer a few questions, and let Reece from Tasse curate the perfect bundle. Free collection from 15 Dec or UK delivery." />
  <link rel="canonical" href="https://bareecesta.co.uk/builder.html" />
  <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
  <meta name="author" content="Reece Jack ‚Äî Tasse & Groundwork" />
  <meta name="theme-color" content="#5a2b10" />

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="/favicon.png" />

  <!-- Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Christmas Coffee Gift Set Builder ‚Äî Barista-Approved Gifts" />
  <meta property="og:description" content="Choose your budget, answer a couple of questions, and get a tailored coffee gift curated by Reece from Tasse Coffee and Groundwork." />
  <meta property="og:url" content="https://bareecesta.co.uk/builder.html" />
  <meta property="og:image" content="https://bareecesta.co.uk/assets/og-gift-builder.jpg" />

  <!-- Twitter / X -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Christmas Coffee Gift Set Builder ‚Äî Barista-Approved Gifts" />
  <meta name="twitter:description" content="Barista-curated coffee bundles with free collection from 15 December or ¬£5 UK delivery." />
  <meta name="twitter:image" content="https://bareecesta.co.uk/assets/og-gift-builder.jpg" />

  <!-- Fonts + Tailwind -->
  <link href="https://fonts.googleapis.com/css2?family=Figtree:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    /* --- Crossfade gallery (no zoom-in; gentle size and padding) --- */
    .fade-host {
      position: relative;
      background: #fff;
      border-radius: 1rem;
      overflow: hidden;
      border: 1px solid rgba(90,43,16,.1);
      aspect-ratio: 4 / 3;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .fade-host img {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: contain;
      padding: 1.5rem;           /* gives breathing room (less ‚Äúzoomed in‚Äù) */
      opacity: 0;
      transition: opacity 1.2s ease;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,.06));
    }
    .fade-host img.is-active { opacity: 1; }

    /* On small screens, zoom out a touch more */
    @media (max-width: 640px) {
      .fade-host img { padding: 2rem; }
    }

    @media (prefers-reduced-motion: reduce) {
      .fade-host img { transition: none; }
    }

    /* Floating checkout bar */
    .floating-bar {
      position: fixed;
      left: 0; right: 0; bottom: 0;
      background: rgba(232, 223, 204, .96);
      border-top: 1px solid rgba(90,43,16,.12);
      padding: 12px 16px;
      display: none;             /* toggled on Step 3 */
      z-index: 60;
      backdrop-filter: blur(6px);
    }
    .floating-bar.show { display: block; }
  </style>
</head>

<body class="bg-white text-black font-figtree">
  <!-- Sticky Announcement -->
  <div class="bg-[#5a2b10] text-white text-center py-2 text-sm font-medium sticky top-0 z-50">
    üéÑ Free collection starts Monday 15 December. UK delivery available (¬£5) that same week ‚Äî we‚Äôll contact you to arrange a time.
  </div>

  <main class="max-w-4xl mx-auto px-6 py-12 sm:py-16" id="pageMain">
    <h1 class="text-3xl sm:text-4xl font-bold text-center text-[#5a2b10] mb-8">Christmas Coffee Gift Set Builder</h1>

    <section class="text-center mb-8">
      <p class="text-neutral-700 mb-2">
        Reece from Tasse is here to rescue your Christmas. I‚Äôve teamed up with my favourite coffee brands ‚Äî <strong>MHW-3 Bomber</strong> and <strong>Orea</strong> ‚Äî to make gifting easy.
      </p>
      <p class="text-neutral-700">
        Pick a budget, answer a couple of quick questions, and I‚Äôll curate a barista-approved bundle that lands just right.
      </p>
    </section>

    <!-- Step Indicators -->
    <div class="flex justify-center items-center gap-4 mb-8" id="steps">
      <div class="w-8 h-8 flex items-center justify-center rounded-full bg-[#5a2b10] text-white font-semibold">1</div>
      <div class="text-[#5a2b10] font-medium">Choose Budget</div>
      <div class="w-8 h-8 flex items-center justify-center rounded-full bg-[#e8dfcc] text-[#5a2b10] font-semibold">2</div>
      <div class="text-[#5a2b10] font-medium">Answer Questions</div>
      <div class="w-8 h-8 flex items-center justify-center rounded-full bg-[#e8dfcc] text-[#5a2b10] font-semibold">3</div>
      <div class="text-[#5a2b10] font-medium">Get Your Bundle</div>
    </div>

    <!-- Step 1 -->
    <section id="step1" class="rounded-3xl border border-neutral-200 bg-white p-6 shadow-sm md:p-8">
      <p class="text-center mb-6 text-neutral-700 font-medium">Pick your budget</p>
      <!-- Primary: now ¬£15, ¬£25, ¬£100 -->
      <div class="grid grid-cols-3 gap-3 sm:gap-4">
        <button type="button" class="amount-btn rounded-2xl border border-neutral-200 px-4 py-4 text-lg font-semibold text-[#5a2b10] hover:shadow cursor-pointer" data-amount="15">¬£15</button>
        <button type="button" class="amount-btn rounded-2xl border border-neutral-200 px-4 py-4 text-lg font-semibold text-[#5a2b10] hover:shadow cursor-pointer" data-amount="25">¬£25</button>
        <button type="button" class="amount-btn rounded-2xl border border-neutral-200 px-4 py-4 text-lg font-semibold text-[#5a2b10] hover:shadow cursor-pointer" data-amount="100">¬£100</button>
      </div>

      <!-- Custom email button -->
      <div class="mt-6 flex justify-center">
        <a href="mailto:bareecesta@gmail.com?subject=Custom%20Coffee%20Gift%20Request&body=Hi%20Reece%2C%0A%0AMy%20budget%3A%20%5B%5D%0ARecipient%27s%20setup%20(espresso%2C%20V60%2C%20etc.)%3A%20%5B%5D%0ACollection%20or%20Delivery%3A%20%5B%5D%0ADeadline%3A%20%5B%5D%0A%0AAny%20notes%3A%20%5B%5D"
           class="inline-block rounded-full bg-[#5a2b10] text-white px-6 py-3 text-sm sm:text-base font-semibold hover:bg-[#4a1f0b] transition">
          Email Reece for a custom gift
        </a>
      </div>

      <div class="mt-6 text-center">
        <button type="button" id="toggleMore" class="text-sm font-semibold text-[#5a2b10] underline underline-offset-4">See more options</button>
      </div>

      <!-- Secondary tiers moved here -->
      <div id="moreTiers" class="mt-4 hidden">
        <div class="grid grid-cols-2 sm:grid-cols-4 gap-3">
          <button type="button" class="amount-btn rounded-2xl border border-neutral-200 px-4 py-3 font-semibold text-[#5a2b10] hover:shadow cursor-pointer" data-amount="50">¬£50</button>
          <button type="button" class="amount-btn rounded-2xl border border-neutral-200 px-4 py-3 font-semibold text-[#5a2b10] hover:shadow cursor-pointer" data-amount="75">¬£75</button>
          <button type="button" class="amount-btn rounded-2xl border border-neutral-200 px-4 py-3 font-semibold text-[#5a2b10] hover:shadow cursor-pointer" data-amount="250">¬£250</button>
          <button type="button" class="amount-btn rounded-2xl border border-neutral-200 px-4 py-3 font-semibold text-[#5a2b10] hover:shadow cursor-pointer" data-amount="500">¬£500</button>
        </div>
      </div>
    </section>

    <!-- Step 2 -->
    <section id="step2" class="hidden rounded-3xl border border-neutral-200 bg-white p-6 shadow-sm md:p-8 mt-8">
      <h2 class="text-xl font-semibold text-[#5a2b10] text-center mb-4">Quick Questions</h2>
      <div id="questionContainer"></div>
      <div id="autoUpgradeNotice" class="hidden mt-4 text-center text-sm text-[#5a2b10] font-medium"></div>
      <div class="mt-6 flex flex-col items-center gap-2">
        <button type="button" id="showRecommendation" disabled
                class="rounded-full bg-[#5a2b10] px-6 py-3 text-sm font-semibold text-white shadow transition disabled:opacity-50 disabled:cursor-not-allowed hover:bg-white hover:text-[#5a2b10]">
          See Our Recommendation
        </button>
        <button type="button" id="changeAmount" class="text-sm font-semibold text-[#5a2b10] underline">Back to Start</button>
      </div>
    </section>

    <!-- Step 3 -->
    <section id="step3" class="hidden rounded-3xl border border-neutral-200 bg-white p-6 shadow-sm md:p-8 mt-8">
      <h2 class="text-xl font-semibold text-[#5a2b10] text-center mb-4">Recommended Bundle</h2>
      <div id="recCard" class="rounded-2xl bg-[#e8dfcc]/50 p-6 mb-4">
        <div id="recImages" class="fade-host"></div>
        <h3 id="recTitle" class="mt-4 text-lg font-semibold text-[#5a2b10]">Loading‚Ä¶</h3>
        <p id="recBody" class="mt-2 text-neutral-800 text-sm">We‚Äôll suggest a bundle based on your answers.</p>
        <div id="recBubbles" class="flex flex-wrap gap-2 mt-4"></div>
      </div>

      <!-- Upgrade option -->
      <label class="flex items-center gap-3 p-4 rounded-2xl bg-[#e8dfcc]/60">
        <input type="checkbox" id="upgradeBeans" class="h-5 w-5">
        <span class="text-sm text-[#5a2b10]">
          <strong>Upgrade beans</strong> to <em>Watermelon Co Ferment</em> for <strong>+¬£7.50</strong>.
        </span>
      </label>
      <p id="upgradeNote" class="hidden mt-2 text-xs text-neutral-600">
        We‚Äôll email a secure ¬£7.50 link for the upgrade right after checkout.
      </p>

      <!-- Pre-checkout info -->
      <p class="mt-4 text-xs sm:text-sm text-neutral-600">
        After checkout, you‚Äôll receive an email ahead of 15 December to confirm delivery details (if you‚Äôve chosen delivery),
        and another email confirming when your gift will be ready to collect from 15 December.
      </p>

      <!-- Actions: Back / Email / Checkout -->
      <div class="mt-6 pb-20 sm:pb-0 flex flex-col sm:flex-row flex-wrap items-center justify-center gap-3">
        <button id="restartBuilder"
                class="rounded-full bg-white text-[#5a2b10] border border-[#5a2b10] px-6 py-3 font-semibold hover:bg-[#5a2b10] hover:text-white transition">
          Back to Start
        </button>

        <a id="emailReece"
           href="mailto:bareecesta@gmail.com?subject=Question%20about%20my%20coffee%20gift%20set&body=Hi%20Reece%2C%0A%0AI%27ve%20just%20used%20the%20Christmas%20Coffee%20Gift%20Set%20Builder%20and%20have%20a%20question%20about%20my%20recommended%20bundle.%0A%0A"
           class="inline-block rounded-full bg-white text-[#5a2b10] border border-[#5a2b10] px-6 py-3 text-sm font-semibold hover:bg-[#5a2b10] hover:text-white transition">
          Email Reece a question
        </a>

        <a id="checkout"
           href="#"
           class="inline-block rounded-full bg-[#5a2b10] text-white px-6 py-3 font-semibold hover:bg-[#4a1f0b] transition">
          Proceed to Checkout
        </a>
      </div>
      <div class="text-center text-xs text-neutral-500 mt-1">
        Checkout opens in a secure Stripe page.
      </div>
    </section>
  </main>

  <!-- Floating Checkout Bar -->
  <div id="floatingBar" class="floating-bar">
    <div class="max-w-4xl mx-auto flex items-center justify-between gap-3">
      <span id="floatingSummary" class="text-xs sm:text-sm text-[#5a2b10] line-clamp-1"></span>
      <a id="checkoutFloating" href="#" class="rounded-full bg-[#5a2b10] text-white px-4 py-2 text-sm font-semibold hover:bg-[#4a1f0b] transition">
        Proceed to Checkout
      </a>
    </div>
  </div>

  <script>
    // --- Data ---
    const paymentLinks = {
      15: 'https://buy.stripe.com/aFa14mfqf9mganw8Ix3F602',
      25: 'https://buy.stripe.com/7sY4gygujcysanwf6V3F600',
      50: 'https://buy.stripe.com/8x200iguj0PK9js6Ap3F603',
      75: 'https://buy.stripe.com/28EaEW4LBgOIeDM9MB3F601',
      100: 'https://buy.stripe.com/3cI00ifqfcys8fo8Ix3F604',
      250: 'https://buy.stripe.com/cNibJ01zp6a4fHQ4sh3F605',
      500: 'https://buy.stripe.com/00weVcemb1TOfHQe2R3F606'
    };

    const upgradePaymentLinks = {
      15: 'https://buy.stripe.com/bJedR8emb0PKbrAaQF3F608',
      25: 'https://buy.stripe.com/14A3cudi71TO7bke2R3F609',
      50: 'https://buy.stripe.com/aFa5kCdi7gOI7bkgaZ3F60a',
      75: 'https://buy.stripe.com/28EcN41zpfKEfHQcYN3F60b',
      100: 'https://buy.stripe.com/5kQ3cub9Z7e867g7Et3F60c',
      250: 'https://buy.stripe.com/9B6eVcce32XSdzI1g53F60d',
      500: 'https://buy.stripe.com/eVqcN44LB41W8foe2R3F607'
    };

    const answers = { v60: null, espresso: null, grinder: null, kettle: null };
    let selectedAmount = null;
    let currentRec = null;

    // --- Elements ---
    const step1 = document.getElementById('step1');
    const step2 = document.getElementById('step2');
    const step3 = document.getElementById('step3');
    const questionContainer = document.getElementById('questionContainer');
    const showRecBtn = document.getElementById('showRecommendation');
    const toggleMore = document.getElementById('toggleMore');
    const moreTiers = document.getElementById('moreTiers');
    const autoNotice = document.getElementById('autoUpgradeNotice');
    const upgradeCb = document.getElementById('upgradeBeans');
    const upgradeNote = document.getElementById('upgradeNote');
    const checkoutBtn = document.getElementById('checkout');

    const floatingBar = document.getElementById('floatingBar');
    const checkoutFloating = document.getElementById('checkoutFloating');
    const floatingSummary = document.getElementById('floatingSummary');

    function setStep(n){
      const circles = document.querySelectorAll('#steps > div.w-8');
      circles.forEach((c,i)=>{
        if(i <= (n-1)*2){
          c.classList.remove('bg-[#e8dfcc]','text-[#5a2b10]');
          c.classList.add('bg-[#5a2b10]','text-white');
        } else {
          c.classList.remove('bg-[#5a2b10]','text-white');
          c.classList.add('bg-[#e8dfcc]','text-[#5a2b10]');
        }
      });
    }

    // Toggle extra tiers
    toggleMore.addEventListener('click', () => {
      moreTiers.classList.toggle('hidden');
      toggleMore.textContent = moreTiers.classList.contains('hidden') ? 'See more options' : 'See fewer options';
    });

    // Amount buttons
    document.querySelectorAll('.amount-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.amount-btn').forEach(b => b.classList.remove('ring-2','ring-[#5a2b10]'));
        btn.classList.add('ring-2','ring-[#5a2b10]');
        selectedAmount = Number(btn.dataset.amount);
        buildQuestions(selectedAmount);
        step1.classList.add('hidden');
        if(questionContainer.dataset.autoskip === 'true'){
          showRecommendation();
        } else {
          step2.classList.remove('hidden');
          setStep(2);
        }
      });
    });

    // Build questions according to spec
    function buildQuestions(amount){
      answers.v60 = answers.espresso = answers.grinder = answers.kettle = null;
      showRecBtn.disabled = true;
      questionContainer.dataset.autoskip = 'false';
      autoNotice.classList.add('hidden');
      autoNotice.textContent = '';

      if(amount === 100){
        questionContainer.innerHTML = '<p class="text-center text-sm text-neutral-600">No extra questions needed for this bundle.</p>';
        questionContainer.dataset.autoskip = 'true';
        return;
      }

      if([15,75,500].includes(amount)){
        questionContainer.innerHTML = '<p class="text-center text-sm text-neutral-600">No extra questions needed for this bundle.</p>';
        questionContainer.dataset.autoskip = 'true';
        return;
      }

      if(amount === 25){
        questionContainer.innerHTML = `
          <div class="rounded-2xl bg-[#e8dfcc]/60 p-5 mb-4">
            <p class="font-medium text-[#5a2b10]">Do they have a V60 at home?</p>
            <div class="mt-3 flex gap-3">
              <button type="button" class="v60-btn rounded-full border border-[#5a2b10] px-5 py-2 text-sm font-semibold text-[#5a2b10] hover:bg-[#5a2b10] hover:text-white" data-val="no">No</button>
              <button type="button" class="v60-btn rounded-full border border-[#5a2b10] px-5 py-2 text-sm font-semibold text-[#5a2b10] hover:bg-[#5a2b10] hover:text-white" data-val="yes">Yes</button>
            </div>
          </div>
          <div id="follow25"></div>
        `;
        return;
      }

      if(amount === 50){
        questionContainer.innerHTML = `
          <div class="rounded-2xl bg-[#e8dfcc]/60 p-5 mb-4">
            <p class="font-medium text-[#5a2b10]">Do they have a V60 at home?</p>
            <div class="mt-3 flex gap-3">
              <button type="button" class="v60-btn rounded-full border border-[#5a2b10] px-5 py-2 text-sm font-semibold text-[#5a2b10] hover:bg-[#5a2b10] hover:text-white" data-val="no">No</button>
              <button type="button" class="v60-btn rounded-full border border-[#5a2b10] px-5 py-2 text-sm font-semibold text-[#5a2b10] hover:bg-[#5a2b10] hover:text-white" data-val="yes">Yes</button>
            </div>
          </div>
          <div id="follow50"></div>
        `;
        return;
      }

      if(amount === 250){
        questionContainer.innerHTML = `
          <div class="rounded-2xl bg-[#e8dfcc]/60 p-5 mb-4">
            <p class="font-medium text-[#5a2b10]">Do they have a temperature control gooseneck kettle?</p>
            <div class="mt-3 flex gap-3">
              <button type="button" class="kettle-btn rounded-full border border-[#5a2b10] px-5 py-2 text-sm font-semibold text-[#5a2b10] hover:bg-[#5a2b10] hover:text-white" data-val="no">No</button>
              <button type="button" class="kettle-btn rounded-full border border-[#5a2b10] px-5 py-2 text-sm font-semibold text-[#5a2b10] hover:bg-[#5a2b10] hover:text-white" data-val="yes">Yes</button>
            </div>
          </div>
          <div id="follow250"></div>
        `;
        return;
      }

      questionContainer.innerHTML = '<p class="text-center text-sm text-neutral-600">No extra questions needed for this bundle.</p>';
      questionContainer.dataset.autoskip = 'true';
    }

    // Delegated clicks for questions
    document.addEventListener('click', (e) => {
      if(e.target.classList.contains('v60-btn')){
        answers.v60 = e.target.dataset.val;
        togglePickState(e.target, '.v60-btn');

        if(selectedAmount === 25){
          const f = document.getElementById('follow25');
          if(answers.v60 === 'no'){
            f.innerHTML = '';
            showRecBtn.disabled = false;
          } else {
            f.innerHTML = `
              <div class="rounded-2xl bg-[#e8dfcc]/60 p-5">
                <p class="font-medium text-[#5a2b10]">Do they have a home espresso machine?</p>
                <div class="mt-3 flex gap-3">
                  <button type="button" class="espresso-btn rounded-full border border-[#5a2b10] px-5 py-2 text-sm font-semibold text-[#5a2b10] hover:bg-[#5a2b10] hover:text-white" data-val="yes">Yes</button>
                  <button type="button" class="espresso-btn rounded-full border border-[#5a2b10] px-5 py-2 text-sm font-semibold text-[#5a2b10] hover:bg-[#5a2b10] hover:text-white" data-val="no">No</button>
                </div>
              </div>`;
            showRecBtn.disabled = true;
          }
        }

        if(selectedAmount === 50){
          const f = document.getElementById('follow50');
          if(answers.v60 === 'no'){
            selectedAmount = 75;
            autoNotice.classList.remove('hidden');
            autoNotice.textContent = 'We\'ve moved you to our ¬£75 bundle (best value for no V60 at home).';
            showRecommendation();
          } else {
            f.innerHTML = `
              <div class="rounded-2xl bg-[#e8dfcc]/60 p-5">
                <p class="font-medium text-[#5a2b10]">Do they have a home espresso machine?</p>
                <div class="mt-3 flex gap-3">
                  <button type="button" class="espresso-btn rounded-full border border-[#5a2b10] px-5 py-2 text-sm font-semibold text-[#5a2b10] hover:bg-[#5a2b10] hover:text-white" data-val="yes">Yes</button>
                  <button type="button" class="espresso-btn rounded-full border border-[#5a2b10] px-5 py-2 text-sm font-semibold text-[#5a2b10] hover:bg-[#5a2b10] hover:text-white" data-val="no">No</button>
                </div>
              </div>`;
            showRecBtn.disabled = true;
          }
        }
      }

      if(e.target.classList.contains('espresso-btn')){
        answers.espresso = e.target.dataset.val;
        togglePickState(e.target, '.espresso-btn');
        showRecBtn.disabled = false;
      }

      if(e.target.classList.contains('kettle-btn')){
        answers.kettle = e.target.dataset.val;
        togglePickState(e.target, '.kettle-btn');
        const f = document.getElementById('follow250');
        if(answers.kettle === 'yes'){
          f.innerHTML = `
            <div class="rounded-2xl bg-[#e8dfcc]/60 p-5">
              <p class="font-medium text-[#5a2b10]">Do they have a grinder?</p>
              <div class="mt-3 flex gap-3">
                <button type="button" class="grinder-btn rounded-full border border-[#5a2b10] px-5 py-2 text-sm font-semibold text-[#5a2b10] hover:bg-[#5a2b10] hover:text-white" data-val="no">No</button>
                <button type="button" class="grinder-btn rounded-full border border-[#5a2b10] px-5 py-2 text-sm font-semibold text-[#5a2b10] hover:bg-[#5a2b10] hover:text-white" data-val="yes">Yes</button>
              </div>
            </div>`;
          showRecBtn.disabled = true;
        } else {
          f.innerHTML = '';
          showRecBtn.disabled = false;
        }
      }

      if(e.target.classList.contains('grinder-btn')){
        answers.grinder = e.target.dataset.val;
        togglePickState(e.target, '.grinder-btn');
        showRecBtn.disabled = false;
      }
    });

    function togglePickState(activeBtn, selector){
      document.querySelectorAll(selector).forEach(b => b.classList.remove('bg-[#5a2b10]','text-white'));
      activeBtn.classList.add('bg-[#5a2b10]','text-white');
    }

    function showRecommendation(){
      const rec = getRecommendation(answers, selectedAmount);
      currentRec = rec;

      document.getElementById('recTitle').textContent = rec.title;
      document.getElementById('recBody').textContent = rec.body;
      buildBubbles(rec.bubbles || []);
      buildCrossfade(rec.images || []);

      // reset upgrade toggle for new recommendation
      upgradeCb.checked = false;
      upgradeNote.classList.add('hidden');

      updateCheckoutHrefs();

      step2.classList.add('hidden');
      step3.classList.remove('hidden');
      setStep(3);

      // show floating bar and add bottom padding to main so content isn't obscured
      floatingBar.classList.add('show');
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    document.getElementById('showRecommendation').addEventListener('click', showRecommendation);
    document.getElementById('changeAmount').addEventListener('click', restart);
    document.getElementById('restartBuilder').addEventListener('click', restart);

    function composeTrackingLink(amount, upgradeOn){
      const base = paymentLinks[amount] || '#';
      const upgraded = upgradeOn && upgradePaymentLinks[amount] ? upgradePaymentLinks[amount] : base;

      const rec = currentRec || getRecommendation(answers, amount);
      const title = rec.title || 'Unknown bundle';

      const ans = [];
      if (answers.v60 !== null) ans.push(`V60:${answers.v60}`);
      if (answers.espresso !== null) ans.push(`Espresso:${answers.espresso}`);
      if (answers.kettle !== null) ans.push(`Kettle:${answers.kettle}`);
      if (answers.grinder !== null) ans.push(`Grinder:${answers.grinder}`);

      const info = `${title} | ¬£${amount} | ${ans.join(', ') || 'No Qs'} | Upgrade:${upgradeOn ? 'Yes' : 'No'}`;
      const encoded = encodeURIComponent(info);
      return `${upgraded}?client_reference_id=${encoded}&prefilled_description=${encoded}`;
    }

    function updateCheckoutHrefs(){
      if (!selectedAmount) {
        checkoutBtn.href = '#';
        checkoutFloating.href = '#';
        return;
      }
      const upgradeOn = upgradeCb.checked;
      const link = composeTrackingLink(selectedAmount, upgradeOn);
      checkoutBtn.href = link;
      checkoutFloating.href = link;

      // update floating summary text
      const rec = currentRec || getRecommendation(answers, selectedAmount);
      floatingSummary.textContent = `${rec.title} ‚Ä¢ ¬£${selectedAmount}${upgradeOn ? ' ‚Ä¢ Co Ferment +' : ''}`;
    }

    upgradeCb.addEventListener('change', () => {
      upgradeNote.classList.toggle('hidden', !upgradeCb.checked);
      updateCheckoutHrefs();
    });

    function restart(){
      document.querySelectorAll('.amount-btn').forEach(b => b.classList.remove('ring-2','ring-[#5a2b10]'));
      Object.keys(answers).forEach(k => answers[k] = null);
      selectedAmount = null;
      questionContainer.innerHTML = '';
      showRecBtn.disabled = true;
      step3.classList.add('hidden');
      step2.classList.add('hidden');
      step1.classList.remove('hidden');
      if(!moreTiers.classList.contains('hidden')){
        moreTiers.classList.add('hidden');
        toggleMore.textContent = 'See more options';
      }
      upgradeCb.checked = false;
      upgradeNote.classList.add('hidden');
      currentRec = null;
      checkoutBtn.href = '#';
      floatingBar.classList.remove('show');
      setStep(1);
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // Recommendation content per tier
    function getRecommendation(a, amount){
      if(amount === 15){
        return {
          title: '¬£15 Gift ‚Äî Beans & Brew',
          body: 'A 250g bag of Brazilian coffee with a personalised label, plus one free coffee at Tasse Specialty Coffee (Edinburgh).',
          bubbles: ['250g Brazilian beans + custom label','1√ó free coffee at Tasse'],
          images: ['coffee.png']
        };
      }
      if(amount === 25){
        if(a.v60 === 'no'){
          return {
            title: '¬£25 Gift ‚Äî V60 Starter',
            body: 'A V60 brew set, a 250g custom-label bag of Brazilian beans, and one free coffee at Tasse.',
            bubbles: ['V60 brew set','250g Brazilian beans + custom label','1√ó free coffee at Tasse'],
            images: ['coffee.png']
          };
        }
        if(a.v60 === 'yes' && a.espresso === 'yes'){
          return {
            title: '¬£25 Gift ‚Äî Milk Pitcher Set',
            body: 'MHW-3 Bomber high-precision latte art pitcher plus a 250g custom-label bag and a free coffee at Tasse.',
            bubbles: ['MHW-3 Bomber milk pitcher','250g Brazilian beans + custom label','1√ó free coffee at Tasse'],
            images: ['coffee.png']
          };
        }
        return {
          title: '¬£25 Gift ‚Äî Beans & Brew',
          body: 'A 250g custom-label bag of Brazilian beans and a free coffee at Tasse.',
          bubbles: ['250g Brazilian beans + custom label','1√ó free coffee at Tasse'],
          images: ['coffee.png']
        };
      }
      if(amount === 50){
        if(a.v60 === 'yes' && a.espresso === 'yes'){
          return {
            title: '¬£50 Gift ‚Äî Espresso Helper',
            body: 'MHW-3 Bomber milk pitcher + Fuego mini precision scales, custom-label beans and a free coffee at Tasse.',
            bubbles: ['MHW-3 Bomber milk pitcher','Fuego mini precision scales','250g Brazilian beans + custom label','1√ó free coffee at Tasse'],
            images: ['reggooseneck.png','reggooseneck1.png','coffee.png']
          };
        }
        if(a.v60 === 'yes' && a.espresso === 'no'){
          return {
            title: '¬£50 Gift ‚Äî Filter Pro',
            body: 'Fuego mini precision scales, vacuum bean container, custom-label beans and a free coffee at Tasse.',
            bubbles: ['Fuego mini precision scales','Vacuum bean container','250g Brazilian beans + custom label','1√ó free coffee at Tasse'],
            images: ['reggooseneck.png','reggooseneck1.png','coffee.png']
          };
        }
        return { title: '¬£50 Gift', body: 'Answer the questions to see the best fit.', bubbles: [], images: [] };
      }
      if(amount === 75){
        return {
          title: '¬£75 Gift ‚Äî Filter Starter Plus',
          body: 'V60 brew setup with a compact gooseneck kettle and the essentials: a 250g custom-label bag and a free coffee at Tasse.',
          bubbles: ['V60 brew set','Gooseneck kettle','250g Brazilian beans + custom label','1√ó free coffee at Tasse'],
          images: ['reggooseneck.png','reggooseneck1.png','coffee.png']
        };
      }
      if(amount === 100){
        return {
          title: '¬£100 Gift ‚Äî Orea Z1 Brew Set',
          body: 'Orea Z1 brewer with 50 filters, custom 250g Brazilian beans, and a free coffee at Tasse.',
          bubbles: ['Orea Z1 brewer','50√ó filter sheets','250g Brazilian beans + custom label','1√ó free coffee at Tasse'],
          images: ['z1brewer.png','z1brewer1.png','z1brewer2.png','coffee.png']
        };
      }
      if(amount === 250){
        if(a.kettle === 'no'){
          return {
            title: '¬£250 Gift ‚Äî Precision Brew Set',
            body: 'MHW-3 Bomber temperature-control gooseneck kettle + Orea Z1 with 300 filters, custom beans and a free coffee at Tasse.',
            bubbles: ['MHW-3 Bomber temp-control kettle','Orea Z1 brewer','300√ó filters','250g Brazilian beans + custom label','1√ó free coffee at Tasse'],
            images: ['gooseneck.png','gooseneck1.png','z1brewer.png','z1brewer1.png','z1brewer2.png','coffee.png']
          };
        }
        if(a.kettle === 'yes' && a.grinder === 'no'){
          return {
            title: '¬£250 Gift ‚Äî Grinder Upgrade Set',
            body: 'MHW-3 Bomber hand grinder + Orea Z1 with 300 filters, custom beans and a free coffee at Tasse.',
            bubbles: ['MHW-3 Bomber hand grinder','Orea Z1 brewer','300√ó filters','250g Brazilian beans + custom label','1√ó free coffee at Tasse'],
            images: ['grinder.png','z1brewer.png','z1brewer1.png','z1brewer2.png','coffee.png']
          };
        }
        return {
          title: '¬£250 Gift ‚Äî Premium Coffee Kit',
          body: 'Orea Z1 with 300 filters, custom beans and a free coffee at Tasse.',
          bubbles: ['Orea Z1 brewer','300√ó filters','250g Brazilian beans + custom label','1√ó free coffee at Tasse'],
          images: ['z1brewer.png','z1brewer1.png','z1brewer2.png','coffee.png']
        };
      }
      if(amount === 500){
        return {
          title: '¬£500 Gift ‚Äî MHW-3 Bomber B-3 Suitcase',
          body: '12-piece pro kit (Blade R3 grinder, smart scale, electric kettle, server, dripper, cups and more) + custom beans and a free coffee at Tasse.',
          bubbles: ['MHW-3 Bomber B-3 suitcase (12-piece)','250g Brazilian beans + custom label','1√ó free coffee at Tasse'],
          images: ['grinder.png','gooseneck.png','coffee.png']
        };
      }
      return {
        title: 'Custom Gift',
        body: 'Your perfect coffee bundle, curated to match their setup.',
        bubbles: [],
        images: []
      };
    }

    function buildBubbles(items){
      const wrap = document.getElementById('recBubbles');
      wrap.innerHTML = '';
      items.forEach(txt => {
        const chip = document.createElement('span');
        chip.className = 'inline-block rounded-full bg-white text-[#5a2b10] border border-[#5a2b10]/20 px-3 py-1 text-xs font-medium';
        chip.textContent = txt;
        wrap.appendChild(chip);
      });
    }

    // Crossfade gallery (slow, not zoomed-in)
    let fadeTimer = null;
    function buildCrossfade(files){
      const host = document.getElementById('recImages');
      host.innerHTML = '';
      if(fadeTimer){ clearInterval(fadeTimer); fadeTimer = null; }
      if(!files || !files.length) return;

      host.className = 'fade-host';
      const imgA = document.createElement('img');
      const imgB = document.createElement('img');
      host.appendChild(imgA);
      host.appendChild(imgB);

      let i = 0;
      let showA = true;

      function setSrc(el, src){ el.src = src; }
      function swap(){
        const file = files[i];
        if(showA){
          setSrc(imgA, file);
          imgA.classList.add('is-active');
          imgB.classList.remove('is-active');
        } else {
          setSrc(imgB, file);
          imgB.classList.add('is-active');
          imgA.classList.remove('is-active');
        }
        showA = !showA;
      }

      // prime first two frames
      setSrc(imgA, files[0]);
      imgA.classList.add('is-active');
      if(files.length > 1){ setSrc(imgB, files[1]); }

      // advance slowly between images
      let idx = 1;
      fadeTimer = setInterval(()=>{
        i = (idx++) % files.length;
        swap();
      }, 3500); // 3.5s per image for a gentle pace
    }
  </script>
</body>
</html>
